{% extends "layout.html" %}
{% block content %}
<h3>Welcome, {{ patient.full_name }}</h3>
<h5>Departments</h5>
<div class="row">
  {% for d in departments %}
    <div class="col-md-3"><div class="card p-2 mb-2"><h6>{{ d.name }}</h6><p>{{ d.description }}</p><a href="{{ url_for('search_doctors') }}?dept={{ d.id }}" class="btn btn-sm btn-outline-primary">View Doctors</a></div></div>
  {% endfor %}
</div>

<hr>
<h5>Your Appointments</h5>
<table class="table">
  <thead><tr><th>ID</th><th>Doctor</th><th>Date</th><th>Time</th><th>Status</th><th>Action</th></tr></thead>
  <tbody>
    {% for a in upcoming %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.doctor.full_name }}</td>
        <td>{{ a.date }}</td>
        <td>{{ a.time.strftime("%H:%M") }}</td>
        <td>{{ a.status }}</td>
        <td>
          <a class="btn btn-sm btn-info" href="{{ url_for('patient_view_appointment', aid=a.id) }}">View</a>
          {% if a.status == 'Booked' %}
            <form method="post" action="{{ url_for('patient_cancel_appointment', aid=a.id) }}" style="display:inline;">
              <button class="btn btn-sm btn-danger" onclick="return confirm('Cancel appointment?')">Cancel</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
